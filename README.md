# B站视频在线人数监测系统

## 项目简介

这是一个用于实时监测B站视频在线人数的系统，通过Node.js后端提供API接口，前端使用Chart.js绘制在线人数趋势图，支持自定义监测频率和数据导出功能。

## 功能特点

- **实时监测**：支持实时获取B站视频的在线人数数据
- **自定义频率**：可选择5秒、10秒、15秒、20秒、30秒的监测间隔
- **数据可视化**：使用Chart.js绘制在线人数趋势图，支持缩放和拖动
- **数据导出**：可导出为CSV格式的表格数据，包含详细的统计信息
- **多视频支持**：支持输入任何BV号进行监测
- **虚数处理**：支持处理B站API返回的模糊在线人数值（如"1.4万+"、"1000+"等）
- **容错处理**：具有完善的错误处理机制，确保系统稳定运行

## 技术架构

### 后端
- **语言**：Node.js
- **框架**：Express
- **依赖**：axios（HTTP请求）、cors（跨域处理）
- **功能**：处理API跨域，获取B站视频在线人数数据，解析模糊值

### 前端
- **语言**：HTML、CSS、JavaScript
- **库**：Chart.js（数据可视化）、chartjs-plugin-zoom（图表缩放）
- **功能**：用户界面，数据可视化，数据导出，实时监测控制

## 快速开始

### 环境要求
- Node.js 12.0+  
- Python 3.0+（用于启动前端服务器）
- 浏览器（推荐Chrome、Firefox、Edge）

### 安装依赖

```bash
# 安装后端依赖
npm install
```

### 启动服务

1. **启动后端服务器**

```bash
node index.js
```

后端服务器将在 http://localhost:3000 运行

2. **启动前端服务器**

```bash
python -m http.server 8000
```

前端服务器将在 http://localhost:8000 运行

### 访问系统

打开浏览器，访问 http://localhost:8000

## 详细使用说明

### 1. 输入BV号

在输入框中输入你想要监测的B站视频BV号，例如 `BV1pgFSzfEvj`

### 2. 设置视频

点击"设置视频"按钮，系统会验证BV号格式并更新视频信息

### 3. 选择监测频率

在下拉菜单中选择你想要的监测间隔（5秒、10秒、15秒、20秒、30秒）

### 4. 开始监测

点击"开始监测"按钮，系统会按照设定的频率开始获取在线人数数据

### 5. 查看趋势

曲线图会实时更新，显示在线人数的变化趋势
- 可以**左右拖动**图表查看不同时间段的数据
- 可以使用**鼠标滚轮**放大缩小图表，查看细节

### 6. 暂停监测

点击"暂停监测"按钮，停止数据收集

### 7. 保存数据

点击"保存曲线图"按钮，下载包含所有监测数据的CSV文件
- CSV文件包含详细的统计信息，如最高在线人数、平均在线人数、人数高峰范围等
- 文件名格式：`bilibili-online-[BV号]-[时间戳].csv`

## 常见问题

### 1. 图表无法渲染

**原因**：可能是数据格式不正确或网络连接问题

**解决方案**：
- 检查网络连接
- 确保BV号正确
- 刷新页面重试

### 2. 在线人数显示为0

**原因**：可能是B站API返回错误或网络连接问题

**解决方案**：
- 检查网络连接
- 稍后重试
- 尝试监测其他视频

### 3. 保存的CSV文件没有数据

**原因**：可能是还没有收集到数据或监测过程中出现错误

**解决方案**：
- 确保已经开始监测并收集到数据
- 暂停监测后再保存数据

## 注意事项

1. **API限制**：B站API可能有请求频率限制，建议使用较长的监测间隔（如30秒），避免触发限制

2. **数据准确性**：B站API返回的在线人数可能是模糊值（如"1.4万+"），系统会解析为近似数字用于统计

3. **网络连接**：系统依赖网络连接获取数据，请确保网络稳定

4. **浏览器兼容性**：推荐使用现代浏览器，如Chrome、Firefox、Edge，以获得最佳体验

5. **数据存储**：系统仅在内存中存储监测数据，刷新页面后数据会丢失，请及时保存重要数据

## 示例

### 监测界面

![监测界面示例](https://i.imgur.com/example.png)

### CSV数据示例

```csv
# B站视频在线人数监测统计
# 视频BV号: BV1pgFSzfEvj
# 监测时间: 2026-02-11T10:00:00.000Z
# 数据点数量: 10
# 最高在线人数: 15000
# 最低在线人数: 8000
# 平均在线人数: 12500.00
# 人数高峰范围: 2个
# 高峰 1: 10:00:00 - 10:05:00, 最高: 15000
# 高峰 2: 10:10:00 - 10:15:00, 最高: 14500

时间,在线人数
10:00:00,10000
10:00:30,12000
10:01:00,13500
10:01:30,15000
10:02:00,14500
10:02:30,13000
10:03:00,11000
10:03:30,9000
10:04:00,8000
10:04:30,9500
```

## 技术实现

### 后端API

- **获取在线人数**：`GET /api/online/:bvid`
- **响应格式**：
  ```json
  {
    "success": true,
    "data": {
      "onlineCount": 10000, // 解析后的数字，用于统计和图表
      "originalOnlineCount": "1万+", // 原始值，用于显示
      "timestamp": "2026-02-11T10:00:00.000Z"
    }
  }
  ```

### 前端功能

- **初始化**：加载页面时初始化图表
- **数据获取**：定时向后端API发送请求，获取在线人数数据
- **数据处理**：解析响应数据，更新图表和状态
- **用户交互**：处理用户的开始/暂停/保存操作

## 贡献

欢迎提交Issue和Pull Request，帮助改进这个项目！

## 许可证

本项目采用MIT许可证。